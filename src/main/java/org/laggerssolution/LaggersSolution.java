package org.laggerssolution;

import org.bukkit.Bukkit;
import org.bukkit.entity.Player;
import org.bukkit.plugin.java.JavaPlugin;
import org.bukkit.scheduler.BukkitRunnable;

public final class LaggersSolution extends JavaPlugin {

    @Override
    public void onEnable() {
        new LagDetection().runTaskTimer(this, 0l, 100l);

    }

    @Override
    public void onDisable() {

    }

    private class LagDetection extends BukkitRunnable {
        @Override
        public void run() {
            checkPlayerPing();
        }
        private void checkPlayerPing() {
            for (Player player : Bukkit.getOnlinePlayers()) {
                int ping = getPing(player);
                if (ping > 200) {
                    player.kickPlayer("Get a better ping please.");
                }
            }
        }
        private int getPing(Player player) {
            try {
                Object handle = player.getClass().getMethod("getHandle").invoke(player);
                return (int) handle.getClass().getField("ping").get(handle);
            }
            catch (Exception e) {
                e.printStackTrace();
                return 0;
            }
        }
    }

}

